---
title: 前端性能优化积累
date: 2016-1-22 10:01:06
tags: web、性能优化
---
1. 阿里云云存储服务-对象存储OSS
对象存储（Object Storage Service，简称OSS），是阿里云对外提供的海量、安全和高可靠的云存储服务。按实际容量及流量收费。可以放置项目图片及项目的静态文件，每个文件对应返回一个url可以直接调用,用此方法可以减轻服务器的压力及减少了http请求次数。当然也可以用其他云服务比如七牛云等，个人博客的话建议用七牛云，认证后会有10g的免费空间，足够使用了。
2. 图片转base64
可根据项目需要来决定是否使用base64，虽然转了base64可减少http请求数，但是过多使用会造成页面的冗余。其次是无法利用浏览器缓存。
3. css sprite
雪碧图又称css精灵，这是一种常用的优化手段，将多个小图片或者小图标合并到一张大图上，根据定位来计算要显示的图标，现在可以用字体图标来代替一些常用的小图标，建议项目中这么干。
4. css及js文件合并与压缩
可以使用打包工具对文件进行处理，比如webpack,gulp,建议自己学习。如果你到了一个牛比的大公司就不用细学了，因为有专门的打包工程师来负责，你只管开发代码就可以了。
5. 从设计实现层面简化页面
　如果你的页面像百度首页一样简单，那么上面的规则基本上都用不着了。保持页面简洁、减少资源的使用是最直接的。
6. 合理设置 HTTP缓存
　    缓存的力量是强大的，恰当的缓存设置可以大大的减少 HTTP请求。（这里需要说明的是，如果直接 F5刷新页面的话效果是不一样的，这种情况下请求数还是一样，不过被缓存资源的请求服务器是 304响应，只有 Header没有Body ，可以节省带宽 )
     那么怎样才算合理设置 ?原则很简单，能缓存越多越好，能缓存越久越好。例如，很少变化的图片资源可以直接通过 HTTP Header中的Expires设置一个很长的过期头 ;变化不频繁而又可能会变的资源可以使用 Last-Modifed来做请求验证。尽可能的让资源能够在缓存中待得更久。
7. Lazy Load Images
延迟加载图片，在移动端常用，因为流量比较贵，要一心想着为用户节省流量及提升用户的体验，这也是前端工程师的职责。这条策略实际上并不一定能减少 HTTP请求数，但是却能在某些条件下或者页面刚加载时减少HTTP请求数。对于图片而言，在页面刚加载的时候可以只加载第一屏，当用户继续往后滚屏的时候才加载后续的图片。这样一来，假如用户只对第一屏的内容感兴趣时，那剩余的图片请求就都节省了。也可理解为按需加载。
8. 将外部脚本置底（将脚本内容在页面信息内容加载后再加载）
浏览器是可以并发请求的，这一特点使得其能够更快的加载资源，然而外链脚本在加载时却会阻塞其他资源，例如在脚本加载完成之前，它后面的图片、样式以及其他脚本都处于阻塞状态，直到脚本加载完成后才会开始加载。如果将脚本放在比较靠前的位置，则会影响整个页面的加载速度从而影响用户体验。最简单可依赖的方法就是将脚本尽可能的往后挪，减少对并发下载的影响。
9. 异步执行 inline脚本(其实原理和上面是一样，保证脚本在页面内容后面加载。)
　　inline脚本对性能的影响与外部脚本相比，是有过之而无不及。首页，与外部脚本一样， inline脚本在执行的时候一样会阻塞并发请求，除此之外，由于浏览器在页面处理方面是单线程的，当 inline脚本在页面渲染之前执行时，页面的渲染工作则会被推迟。简而言之， inline脚本在执行的时候，页面处于空白状态。鉴于以上两点原因，建议将执行时间较长的 inline脚本异步执行，异步的方式有很多种，例如使用 script元素的defer属性(存在兼容性问题和其他一些问题，例如不能使用 document.write)、使用setTimeout ，此外，在HTML5中引入了 Web Workers的机制，恰恰可以解决此类问题。此条没有实践过，因为没写过行内js，当然也不建议写行内js。
10. Lazy Load Javascript（只有在需要加载的时候加载，在一般情况下并不加载信息内容。）
    随着 Javascript框架的流行，越来越多的站点也使用起了框架。不过，一个框架往往包括了很多的功能实现，这些功能并不是每一个页面都需要的，如果下载了不需要的脚本则算得上是一种资源浪费 -既浪费了带宽又浪费了执行花费的时间。目前的做法大概有两种，一种是为那些流量特别大的页面专门定制一个专用的 mini版框架，另一种则是 Lazy Load。YUI 则使用了第二种方式，在 YUI的实现中，最初只加载核心模块，其他模块可以等到需要使用的时候才加载。
    注：YUI 库，全称Yahoo! UI Library。是一组工具和控件，用JavaScript写成, 为的是用DOM 脚本，DHTML和AJAX等技术创建丰富的网页交互式应用程序。
11. 将 CSS放在 HEAD中
    　如果将 CSS放在其他地方比如 BODY中，则浏览器有可能还未下载和解析到 CSS就已经开始渲染页面了，这就导致页面由无 CSS状态跳转到 CSS状态，用户体验比较糟糕。除此之外，有些浏览器会在 CSS下载完成后才开始渲染页面，如果 CSS放在靠下的位置则会导致浏览器将渲染时间推迟。
12. 避免重复的资源请求
　　这种情况主要是由于疏忽或页面由多个模块拼接而成，然后每个模块中请求了同样的资源时，会导致资源的重复请求 
13. js代码级优化
一是尽量减少dom操作。DOM操作应该是脚本中最耗性能的一类操作，例如增加、修改、删除 DOM元素或者对 DOM集合进行操作。二是 慎用with。三是 避免使用 eval和 Function。四是减少作用域链查找。五是字符串拼接：
 在 Javascript中使用"+" 号来拼接字符串效率是比较低的，因为每次运行都会开辟新的内存并生成新的字符串变量，然后将拼接结果赋值给新变量。六是CSS选择符：#top a { color: #444; }。注意：浏览器对选择符的解析是从右往左进行的。如上面的选择符，浏览器必须遍历查找每一个a标签的祖先节点，看看哪个是#top然后再渲染，并不是我们想的那样从左往右进行渲染，当然效率并不像我们想象的那样高。
14. cdn加速
如果面试你上面的基本都说出来了，面试官还问你有什么牛比的优化方案没，你就来一句cdn加速啊,说实在的，你就是再怎么费劲吧次地优化，再怎么减少http请求，也不如直接弄个cdn快，cdn就是这么牛比，一线互联网公司都开启了cdn加速，要不打开网页速度嗖嗖的啊。

上面的优化只是项目中比较常用的，当然还有其他一些常用的优化方案，最后啥也不说了，yahoo前端性能团队总结的35条黄金定律如下图：大家可以自行学习下
![](http://oi28tswuq.bkt.clouddn.com/images/xingnengyouhua.png)
