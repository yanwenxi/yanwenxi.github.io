<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>闫文喜的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="闫文喜，闫文喜的个人博客，web前端博客，前端博客">
<meta property="og:type" content="website">
<meta property="og:title" content="闫文喜的个人博客">
<meta property="og:url" content="http://yanwenxi.github.io/page/5/index.html">
<meta property="og:site_name" content="闫文喜的个人博客">
<meta property="og:description" content="闫文喜，闫文喜的个人博客，web前端博客，前端博客">
<meta property="og:locale" content="中文">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="闫文喜的个人博客">
<meta name="twitter:description" content="闫文喜，闫文喜的个人博客，web前端博客，前端博客">
  
    <link rel="alternative" href="/atom.xml" title="闫文喜的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">Wenxi Yan</a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/Home">我的小窝</a></li>
                        
                            <li><a href="/archives">文章列表</a></li>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/about">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=ywx_software@foxmail.com" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/yanwenxi" title="github">github</a>
                            
                                <a class="fl QQ" target="_blank" href="http://www.webywx.com" title="QQ">QQ</a>
                            
                                <a class="fl wechat" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=ywx_software@foxmail.com" title="wechat">wechat</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Benchmark-jsPerf/" style="font-size: 10px;">Benchmark jsPerf</a> <a href="/tags/ES6、promise/" style="font-size: 10px;">ES6、promise</a> <a href="/tags/H5-移动端优化/" style="font-size: 10px;">H5 移动端优化</a> <a href="/tags/H5、bug/" style="font-size: 10px;">H5、bug</a> <a href="/tags/JS设计模式-设计模式/" style="font-size: 10px;">JS设计模式 设计模式</a> <a href="/tags/Jenkins-CI/" style="font-size: 10px;">Jenkins CI</a> <a href="/tags/Lodash/" style="font-size: 10px;">Lodash</a> <a href="/tags/angular/" style="font-size: 10px;">angular</a> <a href="/tags/angular-http-q-promise/" style="font-size: 10px;">angular $http $q promise</a> <a href="/tags/angular-q-promise/" style="font-size: 10px;">angular $q promise</a> <a href="/tags/angular-decorator/" style="font-size: 10px;">angular decorator</a> <a href="/tags/angular-filter/" style="font-size: 10px;">angular filter</a> <a href="/tags/angular-服务/" style="font-size: 10px;">angular 服务</a> <a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/angular、-http/" style="font-size: 10px;">angular、$http</a> <a href="/tags/angular、Karma/" style="font-size: 10px;">angular、Karma</a> <a href="/tags/angular、directive/" style="font-size: 10px;">angular、directive</a> <a href="/tags/angular、html5/" style="font-size: 10px;">angular、html5</a> <a href="/tags/angular、module、controller/" style="font-size: 10px;">angular、module、controller</a> <a href="/tags/angular、promise、-q、deferred/" style="font-size: 10px;">angular、promise、$q、deferred</a> <a href="/tags/angular、router/" style="font-size: 10px;">angular、router</a> <a href="/tags/angular、ui-router/" style="font-size: 10px;">angular、ui-router</a> <a href="/tags/angular、表达式、filter/" style="font-size: 10px;">angular、表达式、filter</a> <a href="/tags/app-跨平台/" style="font-size: 10px;">app,跨平台</a> <a href="/tags/aso/" style="font-size: 10px;">aso</a> <a href="/tags/blockchain/" style="font-size: 10px;">blockchain</a> <a href="/tags/css-前端开发/" style="font-size: 10px;">css 前端开发</a> <a href="/tags/debugger/" style="font-size: 10px;">debugger</a> <a href="/tags/es5-js/" style="font-size: 10px;">es5 js</a> <a href="/tags/fit/" style="font-size: 10px;">fit</a> <a href="/tags/flex-css3/" style="font-size: 10px;">flex css3</a> <a href="/tags/git-github/" style="font-size: 10px;">git github</a> <a href="/tags/h5-webworkers/" style="font-size: 10px;">h5 webworkers</a> <a href="/tags/i18n/" style="font-size: 10px;">i18n</a> <a href="/tags/iframe/" style="font-size: 10px;">iframe</a> <a href="/tags/javascript、object-oriented、继承/" style="font-size: 10px;">javascript、object-oriented、继承</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/js-Array/" style="font-size: 10px;">js Array</a> <a href="/tags/js-Higher-order-function/" style="font-size: 10px;">js Higher-order-function</a> <a href="/tags/js-closure/" style="font-size: 10px;">js closure</a> <a href="/tags/js-lodash/" style="font-size: 10px;">js lodash</a> <a href="/tags/js-object/" style="font-size: 10px;">js object</a> <a href="/tags/js-scope/" style="font-size: 10px;">js scope</a> <a href="/tags/js-sea-js-模块化/" style="font-size: 10px;">js sea.js 模块化</a> <a href="/tags/js-this/" style="font-size: 10px;">js this</a> <a href="/tags/js-性能调试-Benchmark-jsPerf/" style="font-size: 10px;">js 性能调试 Benchmark jsPerf</a> <a href="/tags/js-柯里化/" style="font-size: 10px;">js 柯里化</a> <a href="/tags/js-纯函数/" style="font-size: 10px;">js 纯函数</a> <a href="/tags/js、变态题/" style="font-size: 10px;">js、变态题</a> <a href="/tags/js、设计模式/" style="font-size: 10px;">js、设计模式</a> <a href="/tags/js、跨域、document-domain/" style="font-size: 10px;">js、跨域、document.domain</a> <a href="/tags/js模块化、AMD、CMD、CommonJs/" style="font-size: 10px;">js模块化、AMD、CMD、CommonJs</a> <a href="/tags/js继承/" style="font-size: 10px;">js继承</a> <a href="/tags/life、意念/" style="font-size: 10px;">life、意念</a> <a href="/tags/lodash-chain/" style="font-size: 10px;">lodash chain</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mongoDB-数据库/" style="font-size: 10px;">mongoDB 数据库</a> <a href="/tags/mvp/" style="font-size: 10px;">mvp</a> <a href="/tags/nginx/" style="font-size: 12.5px;">nginx</a> <a href="/tags/node/" style="font-size: 12.5px;">node</a> <a href="/tags/node-debug/" style="font-size: 10px;">node debug</a> <a href="/tags/node-wechat/" style="font-size: 20px;">node wechat</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/rap/" style="font-size: 17.5px;">rap</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-ant-design/" style="font-size: 10px;">react ant-design</a> <a href="/tags/seo/" style="font-size: 20px;">seo</a> <a href="/tags/seo-新闻源/" style="font-size: 10px;">seo 新闻源</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/web-交互/" style="font-size: 10px;">web 交互</a> <a href="/tags/web、前端/" style="font-size: 10px;">web、前端</a> <a href="/tags/web、性能优化/" style="font-size: 10px;">web、性能优化</a> <a href="/tags/wechat/" style="font-size: 10px;">wechat</a> <a href="/tags/wechat-webstorm/" style="font-size: 10px;">wechat webstorm</a> <a href="/tags/win10、linux/" style="font-size: 10px;">win10、linux</a> <a href="/tags/window-history-html5/" style="font-size: 10px;">window.history html5</a> <a href="/tags/wxapp/" style="font-size: 15px;">wxapp</a> <a href="/tags/yarn-npm/" style="font-size: 10px;">yarn npm</a> <a href="/tags/人生/" style="font-size: 10px;">人生</a> <a href="/tags/前后端分享/" style="font-size: 10px;">前后端分享</a> <a href="/tags/前端工程-构建工具-前端开发/" style="font-size: 10px;">前端工程 构建工具 前端开发</a> <a href="/tags/前端脚手架/" style="font-size: 10px;">前端脚手架</a> <a href="/tags/建站-seo/" style="font-size: 10px;">建站 seo</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/我是点位的以后改/" style="font-size: 10px;">我是点位的以后改</a> <a href="/tags/生活/" style="font-size: 20px;">生活</a> <a href="/tags/移动端、fixed/" style="font-size: 10px;">移动端、fixed</a> <a href="/tags/解构赋值-es6/" style="font-size: 10px;">解构赋值 es6</a> <a href="/tags/跨域、postMessage、html5/" style="font-size: 10px;">跨域、postMessage、html5</a> <a href="/tags/路由-html5/" style="font-size: 10px;">路由 html5</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.webywx.com">前端小站</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://ywxi.github.io/">web博客</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">运动健身、网络营销、web前端、喜欢接触新鲜事物、迎接新的挑战</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">Wenxi Yan</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">Wenxi Yan</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/Home">我的小窝</a></li>
                
                    <li><a href="/archives">文章列表</a></li>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/about">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=ywx_software@foxmail.com" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/yanwenxi" title="github">github</a>
                    
                        <a class="QQ" target="_blank" href="http://www.webywx.com" title="QQ">QQ</a>
                    
                        <a class="wechat" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=ywx_software@foxmail.com" title="wechat">wechat</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-cross-app" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/13/cross-app/" class="article-date">
      <time datetime="2016-12-13T05:17:45.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/cross-app/">跨平台APP的构建方式</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　“一次构建，多处运行”，跨平台APP带着这股风潮把火烧到了前端，为开发者带来无尽的遐想。现有的流行跨平台框架有以下:</p>
<h3 id="1-基于单WebView的开发框架。"><a href="#1-基于单WebView的开发框架。" class="headerlink" title="1. 基于单WebView的开发框架。"></a>1. 基于单WebView的开发框架。</h3><p>　　开发者可以使用现有的最新web技术，开发出单页面web应用。同时利用JSBridge，又能获取原生的API，从而使web应用具有了原生应用的功能。Cordova+IONIC可以说是这个潮流的代表，也是跨平台APP的先锋。然而这类跨平台应用的缺点是不流畅，在安卓手机上体验较差。</p>
<h3 id="2-Hybrid方向。"><a href="#2-Hybrid方向。" class="headerlink" title="2. Hybrid方向。"></a>2. Hybrid方向。</h3><p>　　也就是原生应用配合HTML5技术，让APP具有了部分跨平台的功能。Hybrid也是现在各大互联网企业采用较多的跨平台开发方式。这类APP在体验上优于单WebView的APP，并且能够极大提高开发效率。然而这种方式离“一次构建，多处运行”的设想还是有很大距离，毕竟依然需要针对不同的移动平台进行原生开发。</p>
<h3 id="3-使用Javascript开发纯原生应用。"><a href="#3-使用Javascript开发纯原生应用。" class="headerlink" title="3. 使用Javascript开发纯原生应用。"></a>3. 使用Javascript开发纯原生应用。</h3><p>　　既然单WebView性能有缺憾，Hybrid技术栈又比较高，那么Javascript开发纯原生应用就孕育而生。这个方向的代表有<a href="https://facebook.github.io/react-native/" target="_blank" rel="external">ReactNative</a>, <a href="http://alibaba.github.io/weex/" target="_blank" rel="external">Weex</a>和<a href="https://www.nativescript.org/" target="_blank" rel="external">Nativescript</a>。</p>
<p>　　和ReactNative相比，Nativescript最大的特点是可以获得100%的原生API。也就是说，开发者可以通过Javascript获取和原生开发语言同样多的原生接口。通过例子可以体会到“获取所有原生API”带来的巨大好处。NativeScript是一款使用JavaScript语言来构建跨平台原生移动应用的开源框架，支持iOS、Android和Windows Phone。<br>　　使用Nativescript和Angular2可以很高效地构建跨平台APP！！！<br>    NativeScript一个缺点：无法与原生项目融合，即你只能纯写个NativeScript的应用，不可能把它抽离出来作为某原生应用的一部分来出现。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app-跨平台/">app,跨平台</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-postMessage" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/13/postMessage/" class="article-date">
      <time datetime="2016-12-13T02:23:36.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/postMessage/">跨域之HTML5 postMessage</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　先了解下什么是同源策略，简单来说，协议+域名+端口三者必须相同，若有一个不同，即为跨域！<br>　　相关图解如下：</p>
<div align="center"><br>    <img src="http://oi28tswuq.bkt.clouddn.com/images/corssDomain.png-public" alt=""><br></div>

<p>　　HTML5中最酷的新功能之一就是 <em>跨文档消息传输Cross Document Messaging</em>。下一代浏览器都将支持这个功能：Chrome 2.0+、Internet Explorer 8.0+, Firefox 3.0+, Opera 9.6+, 和 Safari 4.0+ 。 Facebook已经使用了这个功能，用postMessage支持基于web的实时消息传递。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">otherWindow.postMessage(message, targetOrigin);</div></pre></td></tr></table></figure></p>
<p>otherWindow: 对接收信息页面的window的引用。可以是页面中iframe的contentWindow属性；window.open的返回值；通过name或下标从window.frames取到的值。<br>message: 所要发送的数据，string类型。<br>targetOrigin: 用于限制otherWindow，“*”表示不作限制</p>
<p>a.com/index.html中的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;iframe id=&quot;ifr&quot; src=&quot;b.com/index.html&quot;&gt;&lt;/iframe&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">window.onload = function() &#123;</div><div class="line">    var ifr = document.getElementById(&apos;ifr&apos;);</div><div class="line">    var targetOrigin = &apos;http://b.com&apos;;  // 若写成&apos;http://b.com/c/proxy.html&apos;效果一样</div><div class="line">                                        // 若写成&apos;http://c.com&apos;就不会执行postMessage了</div><div class="line">    ifr.contentWindow.postMessage(&apos;I was there!&apos;, targetOrigin);</div><div class="line">&#125;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>b.com/index.html中的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    window.addEventListener(&apos;message&apos;, function(event)&#123;</div><div class="line">        // 通过origin属性判断消息来源地址</div><div class="line">        if (event.origin == &apos;http://a.com&apos;) &#123;</div><div class="line">            alert(event.data);    // 弹出&quot;I was there!&quot;</div><div class="line">            alert(event.source);  // 对a.com、index.html中window对象的引用</div><div class="line">                                  // 但由于同源策略，这里event.source不可以访问window对象</div><div class="line">        &#125;</div><div class="line">    &#125;, false);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/跨域、postMessage、html5/">跨域、postMessage、html5</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-document-domain" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/13/document-domain/" class="article-date">
      <time datetime="2016-12-13T01:54:28.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/document-domain/">js设置document.domain实现跨域的相关注意事项</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　对于主域相同而子域不同的例子，可以通过设置document.domain的办法来解决。具体的做法是可以在<a href="http://www.a.com/a.html和http://script.a.com/b.html两个文件中分别加上document.domain" target="_blank" rel="external">http://www.a.com/a.html和http://script.a.com/b.html两个文件中分别加上document.domain</a> = ‘a.com’；<br>　　本文实例分析了js设置document.domain实现跨域的注意点,仅供参考，具体分析如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　document.domain</div></pre></td></tr></table></figure></p>
<p>　　用来得到当前网页的域名。<br>　　比如在控制台输入：<br>　　代码如下:<br>　　<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">console.log(document.domain);//www.webywx.com</div></pre></td></tr></table></figure></p>
<p>　　我们也可以给document.domain属性赋值，不过是有限制的，你只能赋成当前的域名或者基础域名。<br>　　例如：代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">document.domain=&quot;webywx.com&quot;;</div><div class="line">document.domain=&quot;www.webywx.com&quot;;</div></pre></td></tr></table></figure></p>
<p>　　上面的赋值都是成功的，因为www.webywx.com是当前的域名，而webywx.com是基础域名。<br>　　但是下面的赋值就会出来”参数无效”的错误：<br>　　<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　document.domain=&quot;yanwenxi.site&quot;</div><div class="line">document.domain=&quot;www.yanwenxi.site&quot;</div></pre></td></tr></table></figure></p>
<p>　　因为yanwenxi.site与www.yanwenxi.site不是当前的域名也不是当前域名的基础域名，所以会有参数错误出现。<br>　　这是为了防止有人恶意修改document.domain来实现跨域偷取数据。</p>
<h3 id="利用document-domain-实现跨域："><a href="#利用document-domain-实现跨域：" class="headerlink" title="利用document.domain 实现跨域："></a>利用document.domain 实现跨域：</h3><p>　　<em>前提条件</em>：这两个域名必须属于同一个基础域名!而且所用的协议，端口都要一致，否则无法利用document.domain进行跨域<br>　　Javascript出于对安全性的考虑，而禁止两个或者多个不同域的页面进行互相操作。<br>　　相同域的页面在相互操作的时候不会有任何问题。<br>　　比如在：aaa.com的一个网页(a.html)里面 利用iframe引入了一个bbb.com里的一个网页(b.html)。<br>　　这时在a.html里面可以看到b.html里的内容，但是却不能利用javascript来操作它。因为这两个页面属于不同的域，在操作之前，js会检测两个页面的域是否相等，如果相等，就允许其操作，如果不相等，就会拒绝操作。<br>　　这里不可能把a.html与b.html利用JS改成同一个域的。因为它们的基础域名不相等。(强制用JS将它们改成相等的域的话会报跟上面一样的”参数无效错误。”)<br>　　所以如果在a.html里引入aaa.com里的另一个网页，是不会有这个问题的，因为域相等。<br>　　有另一种情况，两个子域名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　aaa.xxx.com</div><div class="line">　　bbb.xxx.com</div></pre></td></tr></table></figure></p>
<p>　　aaa里的一个网页(a.html)引入了bbb 里的一个网页(b.html)，<br>　　这时a.html里同样是不能操作b.html里面的内容的。<br>　　因为document.domain不一样，一个是aaa.xxx.com，另一个是bbb.xxx.com。<br>　　这时我们就可以通过Javascript，将两个页面的domain改成一样的，<br>　　需要在a.html里与b.html里都加入：<br>　　<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　document.domain = &quot;xxx.com&quot;;</div></pre></td></tr></table></figure></p>
<p>　　这样这两个页面就可以互相操作了。也就是实现了同一基础域名之间的”跨域”。<br>　　备注：这种方式适用于{www.webywx.com, webywx.com, script.webywx.com, css.webywx.com}中的任何页面相互通信。某一页面的domain默认等于window.location.hostname。主域名是不带www的域名，例如webywx.com，主域名前面带前缀的通常都为二级域名或多级域名，例如www.a.com其实是二级域名.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js、跨域、document-domain/">js、跨域、document.domain</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-biantaiti" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/12/biantaiti/" class="article-date">
      <time datetime="2016-12-12T14:26:47.000Z" itemprop="datePublished">2016-12-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/12/biantaiti/">你js这么牛比，你知道++[[]][+[]]+[+[]]的结果么？</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　首先，问这个问题的人是个天才，他怎么会遇到这样的一个问题。其次，回答这个问题的人更是一个天才，我难以想象他会回答这个问题，更难以想象的是，他的回答是如此的详细和丰富和完整，真正称得上诲人不倦。<br>　　既然遇到了这个问题，我们不妨也跟着提高一下。<br>　　这是一个Javascript语言题目，一个完全有效的等式，不信自己可以试一下，下面看看高人的题解：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">++[[]][+[]]+[+[]]</div></pre></td></tr></table></figure></p>
<p>　　如果把这段表达式拆分开来，它相等于：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">++[[]][+[]]</div><div class="line">+</div><div class="line">[+[]]</div></pre></td></tr></table></figure></p>
<p>　　在JavaScript里，+[] === 0 是完全正确的。 + 会把一些字符转化成数字，在这里，这个式子会变成 +”” 或 0。<br>　　因此，我们可以简化一下(++ 比 + 有更高的优先级)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">++[[]][0]</div><div class="line">+</div><div class="line">[0]</div></pre></td></tr></table></figure></p>
<p>　　因为 [[]][0] 的意思是：获取 [[]] 的第一个元素，这就得出了下面的结果：</p>
<p>[[]][0] 返回内部数组 ([])。根据语言规范，我们说 [[]][0] === [] 是不正确的，但让我们把这个内部数组称作 A，以避免错误的写法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">++[[]][0] == A + 1， 因为 ++ 的意思是“加一”。</div><div class="line">++[[]][0] === +(A + 1)；换句话说，你得到的永远是个数值( +1 并不一定得到的是个数值，但 ++ 一定是)。</div></pre></td></tr></table></figure></p>
<p>　　同样，我们可以把这一堆代码简化的更清晰。让我们把 A 换回成 [] :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+([] + 1)</div><div class="line">+</div><div class="line">[0]</div></pre></td></tr></table></figure></p>
<p>　　在JavaScript里，这也是正确的：[] + 1 === “1”，因为 [] == “” (这相当于一个空的数组的内部元素连接)，于是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+([] + 1) === +(“” + 1)，并且</div><div class="line">+(“” + 1) === +(“1”)，并且</div><div class="line">+(“1”) === 1</div></pre></td></tr></table></figure></p>
<p>　　让我们再次简化一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">+</div><div class="line">[0]</div></pre></td></tr></table></figure></p>
<p>　　同样，在Javascript里，这是正确的：[0] == “0”，因为这是相当于一个有一个元素的数组的内部元素的连接。各元素会使用，分隔。当只有一个元素时，你可以推论出这个过程的结果就是它自身的第一个元素。</p>
<p>　　所以，最终我们得到(数字 + 字符串 = 字符串)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">+</div><div class="line">&quot;0&quot;</div><div class="line">=== &quot;10&quot; // 耶！</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js、变态题/">js、变态题</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-angular-html5" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/12/angular-html5/" class="article-date">
      <time datetime="2016-12-12T14:04:54.000Z" itemprop="datePublished">2016-12-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/12/angular-html5/">让AngularJS指令符合html5规范</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>　　AngularJS,是Google开源的一款JavaScript MVVM框架，弥补了HTML在构建应用方面的不足，其通过使用指令（directives）结构来扩展HTML的属性，使开发者可以使用HTML来声明动态内容，从而使得Web开发和测试工作变得更加容易。</p>
<p>　　在学习中无意间看到有人说自定义指令如果想符合HTML5规范，可以加上data-<em>或者x-</em>前缀，对指令本身不影响，我顺便也试了下默认指令，发现ng-app、ng-model、ng-bind这类默认指令也可以直接加上data-*的前缀，而且完全不用配置，不影响功能。</p>
<p>　　所以，为了遵循HTML5规范，我们也可以使用data-ng-app、data-ng-model、data-ng-bind这样的属性来使用AngularJS的默认指令了。</p>
<p>　　最后来验证一下：原程序里面是这样写的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var ngAttrPrefixes = [&apos;ng-&apos;, &apos;data-ng-&apos;, &apos;ng:&apos;, &apos;x-ng-&apos;];</div></pre></td></tr></table></figure></p>
<p>　　所以说，ng-、data-ng-、ng:、x-ng-，都是可以生效的。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angular、html5/">angular、html5</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-data-compare" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/10/data-compare/" class="article-date">
      <time datetime="2016-12-10T03:22:45.000Z" itemprop="datePublished">2016-12-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/10/data-compare/">非关系型数据库和关系型数据库比较</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="关系型数据库的特点"><a href="#关系型数据库的特点" class="headerlink" title="关系型数据库的特点"></a>关系型数据库的特点</h3><p><img src="http://oi28tswuq.bkt.clouddn.com/images/relative.png" alt="database-compare"><br>常见的关系型数据库:Microsoft SQLServer,   Oracle, MySQL，  Microsoft Access.<br>Not Only SQL简称NoSQL，泛指非关系型的数据库。<br>常见NoSQL有那些？MongoDB,Hbase（HadoopDatabase） ,Redis.</p>
<h3 id="Nosql数据库的分类："><a href="#Nosql数据库的分类：" class="headerlink" title="Nosql数据库的分类："></a>Nosql数据库的分类：</h3><p><img src="http://oi28tswuq.bkt.clouddn.com/images/Nosql.png" alt="Nosql"></p>
<h2 id="NoSQL的优点-缺点"><a href="#NoSQL的优点-缺点" class="headerlink" title="NoSQL的优点/缺点"></a>NoSQL的优点/缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点:"></a>优点:</h3><ul>
<li>高可扩展性</li>
<li>分布式计算</li>
<li>低成本</li>
<li>架构的灵活性，半结构化数据</li>
<li>没有复杂的关系<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点:"></a>缺点:</h3></li>
<li>没有标准化</li>
<li>有限的查询功能（到目前为止）</li>
<li>最终一致性是不直观的程序 </li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongoDB-数据库/">mongoDB 数据库</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-docker" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/04/docker/" class="article-date">
      <time datetime="2016-12-04T02:47:19.000Z" itemprop="datePublished">2016-12-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/04/docker/">使用Docker快速发布nodejs应用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>使用docker发布一个nginx+nodejs(express,koa)项目，然后使用jenkins进行简单地持续集成发布工作，nodejs配合docker和jenkins可以更加方便地管理我们的应用！<br>对docker的理解：未完待更新。。。临时有事。。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Jenkins-CI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/02/Jenkins-CI/" class="article-date">
      <time datetime="2016-12-02T05:29:54.000Z" itemprop="datePublished">2016-12-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/02/Jenkins-CI/">基于Jenkins的持续集成CI</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="CI（continuous-integration）持续集成"><a href="#CI（continuous-integration）持续集成" class="headerlink" title="CI（continuous integration）持续集成"></a>CI（continuous integration）持续集成</h4><p>持续集成指的是，频繁地（一天多次）将代码集成到主干。持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。<br>一次构建：可能包含编译，测试，审查和部署，以及其他一些事情，一次构建就是将源代码放在一起，并验证软件是否可以作为一个一致的单元运行的过程。可以理解为频繁的在多个团队的工作中集成，并且给与反馈的过程。团队开发成员经常集成它们的工作，每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。</p>
<h4 id="CI场景如下："><a href="#CI场景如下：" class="headerlink" title="CI场景如下："></a>CI场景如下：</h4><p>（1）开发人员向版本控制库提交代码，同时，集成构建计算机上的CI服务器正在轮询检查版本控制库中的变更<br>（2）在提交发生之后，CI服务器检测到版本控制库中发生了变更，所以CI服务器会从库中取得最新的代码副本，执行构建脚本，该脚本将对软件进行集成<br>（3）CI服务器向指定的项目成员发成电子邮件，提供构建结果的反馈信息。<br>（4）CI服务器继续轮询版本控制库中的变更。</p>
<h4 id="CI持续集成周期"><a href="#CI持续集成周期" class="headerlink" title="CI持续集成周期"></a>CI持续集成周期</h4><p>一个典型的持续集成周期包括以下几个步骤：<br>（1）持续集成服务器不断从版本控制服务器上检查代码状态，看代码是否有更新。<br>（2）如果发现代码有最新的提交，那么就从版本控制服务器下载最新的代码。<br>（3）等代码完全更新以后，调用自动化编译脚本，进行代码编译。<br>（4）运行所有的自动化测试。<br>（5）进行代码分析。<br>（6）产生可执行的软件，能够提供给测试人员进行测试。</p>
<h4 id="CI系统"><a href="#CI系统" class="headerlink" title="CI系统"></a>CI系统</h4><p>在CI中您需要一个版本控制库，比如（GIT或者SVN）来执行CI。版本控制库，大家都知道git，可以方便的管理源代码，可以沿着时间轴取得不同同版本的代码。CI服务器在变更提交到版本库后执行的集成构建，他会每个一段时间去检查版本库中的变更，所以我们需要对CI服务器进行配置。CI服务器还需要提供一个方便的显示板来显示构建的结果。但是CI服务器并不是必须的，也<strong>可以通过执行构建脚本来执行构建</strong>。</p>
<p>从上面我们知道CI的4个基本特征：与版本控制库链接，构建脚本，某种类型的反馈机制，集成源代码变更的过程。这也是CI系统的4个基本功能。一个好的CI系统的关键特征就是速度，这个系统的本质就及时向开发者和项目风险承担者提供反馈信息。</p>
<p>既然CI这么好，但还是有些团队并没有选择使用，其实这是一个综合考虑的结果。使用CI会增加一些成本的，比如增加了维护CI系统的开销，变化太多尤其是对于老项目需要改变很多才能实现CI。失败的构建太多，如果在提交代码之前没有私有构建一次，就会造成在使用ci的时候变更变得频繁。存在额外的硬件和软件成本，使用ci就需要一台独立的集成服务器。</p>
<h4 id="CI工具"><a href="#CI工具" class="headerlink" title="CI工具"></a>CI工具</h4><p>持续集成工具：jenkins、CruiseControl、Hudson、gauntlet<br>构建工具：Maven、Ant、groovy<br>CDBI：持续数据库集成，即每次项目的版本控制库中发生变更时，重建数据库和测试数据。</p>
<h4 id="建议使用Jenkins"><a href="#建议使用Jenkins" class="headerlink" title="建议使用Jenkins"></a>建议使用Jenkins</h4><p>Jenkins 是一个开源项目，提供了一种易于使用的持续集成系统，使开发者从繁杂的集成中解脱出来，专注于更为重要的业务逻辑实现上。同时 Jenkins 能实施监控集成中存在的错误，提供详细的日志文件和提醒功能，还能用图表的形式形象地展示项目构建的趋势和稳定性。Jenkins 还提供了非常丰富的插件支持，这使得 Jenkins 变得越来越强大。我们可以方便的安装各种第三方插件，从而方便快捷的集成第三方的应用。</p>
<h4 id="基于Jenkins快速搭建CI环境"><a href="#基于Jenkins快速搭建CI环境" class="headerlink" title="基于Jenkins快速搭建CI环境"></a>基于Jenkins快速搭建CI环境</h4><p>首先要知道一个持续集成环境需要包括三个方面要素：代码存储库、构建过程和持续集成服务器。<br>​代码存储库一般使用GITlab;<br>1、开始新建一个 Jenkins 项目， 由于我们需要连接gitlab的代码仓库， 我们选择 Build a free-style software project。</p>
<p>2、然后配置这个 JenkinsTest 项目了，根据实际的 gitlab服务器信息配置 Source Code Management，这能让 Jenkins 知道如何从哪里获取最新的代码。</p>
<p>3、根据开发需要，隔一段时间需要重新构建一次。选择 Build periodically，在 Schedule 中填写 0 <em> </em> <em> </em>对应的构建时间。</p>
<p>4、添加 build 的步骤了。Jenkins 提供了四个选项供我们选择，可以根据需要执行或调用外部命令和脚本，例如ant、shell、maven等等。这些脚本都是根据需要自己配置的。</p>
<p>5、可以在 Jenkins 中观察构建的进度和最终的状态——成功或者失败。太阳代表之前的构建没有任何失败，蓝色的小球代表构建成功。也可以在JenkinsTest 查看单次构建的 Console 的输出结果。从中能看到构建的第一步是从 gitlab服务器上 check out 代码，然后在build。</p>
<p>声明：文章部分内容参考来源于网络。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins-CI/">Jenkins CI</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-blockchain" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/01/blockchain/" class="article-date">
      <time datetime="2016-12-01T06:36:46.000Z" itemprop="datePublished">2016-12-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/01/blockchain/">基于区块链的web前端开发</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>   最近听同学说区块链技术很火，各大银行及金融企业都在研究，我还以为是后端的技术了，听说前端也可以写，所以有了这篇文章，先记录下来然后后续再补充。<br>   区块链是新的热门技术。如果你没听说过它，你可能听说过比特币。区块链是比特币的底层技术。专家说区块链将会和因特网一样掀起一场革命。说到这里，我好期待啊，期待纸币走向灭亡，以后都用电子货币。</p>
<p>   web技术的发展来源技术驱动力，blockchain技术发展了p2p网络的优点，成为w3c青睐的技术。<br>   至于区块链的技术就不写了，只是初步地了解，很多地方理解的不是很到位，以免误导别人。如果你想学习，可以自己查资料。</p>
<p>web1.0:网络是信息的提供者，可以理解为单向信息，信息是只读的，缺少互动。过去时。</p>
<p>web2.0:网络是一个平台，用户可以提供信息通过网络来与其他用户进行沟通，此时用户之间可以通过网络互动。现在时。</p>
<p>web3.0: 网站内的信息可以直接和其他网站相关信息进行交互，能通过第三方信息平台同时对多家网站的信息进行整合使用；用户在互联网上拥有自己的数据，并能在不同网站上使用；完全基于web，用浏览器即可实现复杂系统程序才能实现的系统功能;用户数据审计后，同步于网络数据。将来时。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blockchain/">blockchain</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-angular-promise-two" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/01/angular-promise-two/" class="article-date">
      <time datetime="2016-12-01T03:50:04.000Z" itemprop="datePublished">2016-12-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/01/angular-promise-two/">通过$q,angular可以实现两种形式的promise</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="q"><a href="#q" class="headerlink" title="$q"></a>$q</h4><p>在angular中，$q是一个非常重要的service。通过$q，angular有两种比较常用的方式来实现promise，分别是ES6风格与jquery风格。</p>
<p><strong>ES6风格实现代码如下：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;div ng-app=&quot;app&quot; ng-controller=&quot;demoController&quot;&gt;&lt;/div&gt;</div><div class="line">angular.module(&apos;app&apos;, [])</div><div class="line">.controller(&apos;demoController&apos;, function($q, $timeout) &#123;</div><div class="line">    var a = 1;</div><div class="line">    $q(function(resolve, reject) &#123;</div><div class="line">        $timeout(function() &#123;</div><div class="line">            if(a == 1) &#123;</div><div class="line">                console.log(&apos;resolve&apos;);</div><div class="line">                resolve(&apos;hello, JAKE&apos;);    </div><div class="line">            &#125; else &#123;</div><div class="line">                console.log(&apos;reject&apos;);</div><div class="line">                reject(&apos;JAKE is not here!&apos;)</div><div class="line">            &#125;</div><div class="line">        &#125;, 2000)</div><div class="line">    &#125;)</div><div class="line">    .then(function(greeting) &#123;</div><div class="line">        console.log(&apos;success, &apos; + greeting);</div><div class="line">    &#125;, function(reason) &#123;</div><div class="line">        console.log(&apos;failed, &apos; + reason);</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>当a==1，输出结果为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;resolve&quot;</div><div class="line">&quot;success, hello, JAKE&quot;</div></pre></td></tr></table></figure></p>
<p>当a!=1，输出结果为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;reject&quot;</div><div class="line">&quot;failed, JAKE is not here!&quot;</div></pre></td></tr></table></figure></p>
<p>上例中，我直接将第一步逻辑在$q()中处理。回调函数有两个参数，resolve, reject，分别代表执行成功与失败。<br>然后在对应的逻辑里面，使用resolve/reject标记逻辑的执行状态。then方法中的代码会在第一步的逻辑执行完了才执行。<br><strong>jquery风格代码如下</strong></p>
<p>  与jquery实现类似，我们需要定义个defer对象，并在第一步逻辑中手动返回promise<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">angular.module(&apos;app&apos;, [])</div><div class="line">.controller(&apos;demoController&apos;, function($q, $timeout) &#123;</div><div class="line">    var a = 1;</div><div class="line">    $q.when(function() &#123;//$q.when()方法能把函数的返回值包装成一个promise,这样可以用then方法了。</div><div class="line">        var defer = $q.defer();</div><div class="line">        $timeout(function() &#123;</div><div class="line">            defer.notify(&apos;notify jake.&apos;);//notify用在resolve和reject之前，在两者之前被调用。</div><div class="line">            </div><div class="line">            if(a == 1) &#123;</div><div class="line">                console.log(&apos;rsolve&apos;);</div><div class="line">                defer.resolve(&apos;hello, jake&apos;);</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                console.log(&apos;reject&apos;);</div><div class="line">                defer.reject(&apos;jake is not here.&apos;)</div><div class="line">            &#125;</div><div class="line">        &#125;, 2000);</div><div class="line">        return defer.promise;</div><div class="line">    &#125;())</div><div class="line">    .then(function(greeting) &#123;</div><div class="line">        console.log(&apos;success, &apos; + greeting);</div><div class="line">    &#125;, function(reason) &#123;</div><div class="line">        console.log(&apos;fail, &apos; + reason);</div><div class="line">    &#125;, function(update) &#123;</div><div class="line">        console.log(&apos;notify, &apos; + update);</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>当a==1，输出结果为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//先打印状态，再defer.resolve或者defer.reject之前执行defer.notify，之后才执行defer.resolve或者defer.reject。</div><div class="line">&quot;rsolve&quot;</div><div class="line">&quot;notify, notify jake.&quot;</div><div class="line">&quot;success, hello, jake&quot;</div></pre></td></tr></table></figure></p>
<p>当a!=1 输出结果为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;reject&quot;</div><div class="line">&quot;notify, notify jake.&quot;</div><div class="line">&quot;fail, jake is not here.&quot;</div></pre></td></tr></table></figure></p>
<p><strong>Angular 中 Promise 的一些方法，其实从上面的实例就已经能够知道promise的大概用法，不算复杂。</strong></p>
<ol>
<li><p>then(successCallback, errorCallback, notifyCallback)<br>从字面上我们就能够看出then三个回调的含义，第二个参数与第三个参数为可选。</p>
</li>
<li><p>catch(errorCallback)<br>相当于 then(null, errorCallback)</p>
</li>
<li><p>finally(callback)<br>无论promise的返回状态是resolve还是reject，该方法总是会执行。</p>
<h4 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h4><p>如果then中逻辑的执行需要时间等待，那么，then中回调函数的返回值为promise对象时，才能够按顺序执行。因此需要我们手动返回一个promise对象，例子如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">var app = angular.module(&apos;app&apos;, []);</div><div class="line"></div><div class="line">app.controller(&apos;demoController&apos;, function($q, $timeout) &#123;</div><div class="line">    $q.when(function() &#123;</div><div class="line">        var defer = $q.defer();</div><div class="line">        $timeout(function() &#123;</div><div class="line">            console.log(&apos;first&apos;);</div><div class="line">            defer.resolve();</div><div class="line">        &#125;, 2000);</div><div class="line">        return defer.promise;</div><div class="line">    &#125;())</div><div class="line">    .then(function() &#123;</div><div class="line">        var defer = $q.defer();</div><div class="line">        $timeout(function() &#123;</div><div class="line">            defer.resolve();</div><div class="line">            console.log(&apos;second&apos;);</div><div class="line">        &#125;, 1000);</div><div class="line">        return defer.promise;</div><div class="line">    &#125;)</div><div class="line">    .then(function() &#123;</div><div class="line">        console.log(&apos;third&apos;);    </div><div class="line">    &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//结果如下：</div><div class="line">&quot;first&quot;</div><div class="line">&quot;second&quot;</div><div class="line">&quot;third&quot;</div></pre></td></tr></table></figure>
<p>官方文档中，认为then方法中只需要有返回值即可，但是如果then的执行不需要时间等待，then中的回调函数的第一个参数，会获取到上一个then的返回值，然后按顺序执行，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">var app = angular.module(&apos;app&apos;, []);</div><div class="line"></div><div class="line">app.controller(&apos;demoController&apos;, function($q, $timeout) &#123;</div><div class="line">    </div><div class="line">    function first() &#123;</div><div class="line">        var a = 1;</div><div class="line">        var defer = $q.defer();</div><div class="line">        $timeout(function() &#123;</div><div class="line">            if(a == 1) &#123;</div><div class="line">                console.log(&apos;first resolve&apos;);</div><div class="line">                defer.resolve(&apos;resolve result&apos;);    </div><div class="line">            &#125; else &#123;</div><div class="line">                console.log(&apos;first reject&apos;);</div><div class="line">                defer.reject();</div><div class="line">            &#125;</div><div class="line">        &#125;, 2000)</div><div class="line">        return defer.promise;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    var promiseA = first();</div><div class="line">    </div><div class="line">    promiseA.then(function(result) &#123;</div><div class="line">        // $timeout(function() &#123;</div><div class="line">        console.log(&apos;second, &apos; + result);</div><div class="line">        return &apos;document&apos;;</div><div class="line">        // &#125;, 1000)</div><div class="line">        </div><div class="line">    &#125;)</div><div class="line">    .then(function(result) &#123;</div><div class="line">        console.log(&apos;third, &apos; + result);</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//结果如下：</div><div class="line">&quot;first resolve&quot;</div><div class="line">&quot;second, resolve result&quot;</div><div class="line">&quot;third, document&quot;</div></pre></td></tr></table></figure>
<h4 id="http"><a href="#http" class="headerlink" title="$http"></a>$http</h4><p>$http是对promise的最佳实践。由于项目中有多个controller要用到请求回来的数据，在每一个控制器内都写一遍会使代码冗余，也太麻烦，因此我们常常会将获取数据的操作放在自定义的服务中。例子如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">angular.module(&apos;app&apos;, [])</div><div class="line">.controller(&apos;demoController&apos;, function(dataFactory) &#123;</div><div class="line">    dataFactory.getData().then(function(resp) &#123;</div><div class="line">        console.log(resp);</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line">.factory(&apos;dataFactory&apos;, function($http) &#123;</div><div class="line">    return &#123;</div><div class="line">        getData: function() &#123;</div><div class="line">            var url = &apos;https://www.webywx.com/list?id=1&apos;;</div><div class="line">            return $http.get(url);    </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>我们将then中回调函数的参数打印出来，发现格式如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Object &#123;</div><div class="line">    config: Object &#123;&#125;,</div><div class="line">    data: Object &#123;&#125;,</div><div class="line">    headers: function(d) &#123;&#125;,</div><div class="line">    status: 200,</div><div class="line">    statusText: &apos;OK&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这一点与jquery的返回值略有不同，他们分别表示的意思为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">config： 请求的配置信息</div><div class="line">data： 返回的数据</div><div class="line">headers: 请求的头部信息</div><div class="line">status: 返回的状态码</div></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angular-q-promise/">angular $q promise</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2017 Wenxi Yan
            </div>
            <div class="footer-right">
                <a href="http://webywx.com/" target="_blank">webywx</a>  Theme <a href="https://yanwenxi.site" target="_blank">前端在路上</a> by Scorpio
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >用户到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>